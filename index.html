<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>부산외국어대학교 글로컬크리에이터 하단 | Google Search Clone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 기본 스타일 및 초기화 (생략 없이 유지) */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap');
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #202124;
            color: #e8eaed;
            -ms-overflow-style: none; scrollbar-width: none;
        }
        body::-webkit-scrollbar { display: none; }
        .text-google-blue { color: #8ab4f8; }
        .text-google-yellow { color: #fbbc04; }
        .bg-search-bar { background-color: #303134; }
        
        /* Leaflet CSS for Map Preview */
        @import url('https://unpkg.com/leaflet@1.9.4/dist/leaflet.css');
        
        /* Map container should have specific dimensions */
        #mapPreview {
            width: 100%;
            height: 100%;
        }
        /* Leaflet Map 컨테이너 배경색 설정 */
        #mapPreview .leaflet-container {
            background-color: #ccc;
        }
    </style>
</head>
<body>

<div id="app" class="min-h-screen">
        <header class="w-full border-b border-white/10 sticky top-0 z-40 bg-[#202124]/80 backdrop-blur">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4">
            <div class="text-2xl font-bold tracking-tight">Goo<span class="text-google-blue">gle</span></div>
            
            <div class="flex-1">
                <div class="flex items-center gap-2 bg-search-bar rounded-full pl-4 pr-2 py-2 border border-transparent shadow">
                    <span class="text-[#bdc1c6] text-sm">🔎</span>
                    <input
                        id="searchInput"
                        value="부산외국어대학교 글로컬크리에이터 하단"
                        placeholder="검색 또는 URL 입력"
                        class="flex-1 bg-transparent outline-none placeholder:text-[#9aa0a6] text-sm text-[#e8eaed]"
                        data-testid="search-input"
                        readonly
                    />
                    <button
                        id="searchSubmit"
                        type="button"
                        class="px-4 py-1.5 bg-[#8ab4f8] text-[#202124] rounded-full text-sm font-semibold hover:brightness-95"
                        data-testid="search-submit"
                    >
                        Google 검색
                    </button>
                </div>
            </div>
            <button class="w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center font-medium">B</button>
        </div>
        
        <div class="max-w-7xl mx-auto px-4 flex items-center gap-8 text-sm text-[#9aa0a6]">
                        <a href="#" class="flex items-center gap-1 py-2 border-b-2 border-google-blue text-google-blue font-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M15 4V1H9v3H0v3h24V4h-9zM2 9v2h20V9H2zm0 6h20v-2H2v2zm0 4h20v-2H2v2z"/></svg>
                <span>전체</span>
            </a>
            <a href="#" class="flex items-center gap-1 py-2 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21.96 11.08l-2.09-2.09c-.19-.19-.45-.29-.71-.29-.26 0-.52.1-.71.29l-.92.92-1.42-1.42-.92-.92c-.19-.19-.45-.29-.71-.29-.26 0-.52.1-.71.29l-1.42 1.42-1.42-1.42c-.19-.19-.45-.29-.71-.29-.26 0-.52.1-.71.29l-1.42 1.42L3.13 8.99c-.19-.19-.45-.29-.71-.29-.26 0-.52.1-.71.29l-2.09 2.09c.19.19.29.45.29.71 0 .26.1.52.29.71l1.42 1.42-1.42 1.42c-.19.19-.29.45-.29.71 0 .26.1.52.29.71l2.09 2.09c.19.19.45.29.71.29.26 0 .52-.1.71-.29l1.42-1.42 1.42 1.42c-.19.19.45.29.71.29.26 0 .52-.1.71-.29l1.42-1.42 1.42 1.42c-.19.19.45.29.71.29.26 0 .52-.1.71-.29l2.09-2.09c.19-.19.29-.45.29-.71 0-.26-.1-.52-.29-.71l-1.42-1.42 1.42-1.42c.19-.19.29-.45.29-.71 0-.26-.1-.52-.29-.71z"/></svg>
                <span>이미지</span>
            </a>
            <a href="#" class="flex items-center gap-1 py-2 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M10 16.5l6-4.5-6-4.5v9zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/></svg>
                <span>동영상</span>
            </a>
            <a href="#" class="flex items-center gap-1 py-2 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zM7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.88 16.19 7 11.88 7 9z"/></svg>
                <span>지도</span>
            </a>
            <a href="#" class="flex items-center gap-1 py-2 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                <span>더보기</span>
            </a>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 pt-6 grid grid-cols-1 lg:grid-cols-[minmax(0,1fr)_360px] gap-8">
        
        <section class="col-span-full">
                        <div class="mb-3">
                <h1 class="text-2xl md:text-[28px] font-semibold tracking-tight text-[#e8eaed]">글로컬크리에어터 중단팀</h1>
                <div class="text-sm text-[#9aa0a6] mt-1">부산광역시 금정구 금샘로 485번길 65</div>
            </div>

            <div class="grid lg:grid-cols-[minmax(0,1fr)_360px] gap-4">
                <div class="relative rounded-2xl overflow-hidden border border-white/10 bg-search-bar">
                    <img 
                        referrerPolicy="no-referrer"
                                                src="https://via.placeholder.com/600x360/303134/e8eaed?text=Team+Photo" 
                        alt="글로컬 크리에이터 팀 사진" 
                        class="w-full h-[260px] md:h-[360px] object-cover" 
                    />
                    <div class="absolute bottom-3 right-3 flex gap-2">
                        <button class="w-8 h-8 grid place-items-center rounded-full bg-black/60 text-white text-sm">‹</button>
                        <button class="w-8 h-8 grid place-items-center rounded-full bg-black/60 text-white text-sm">›</button>
                    </div>
                </div>

                <div class="grid gap-4">
                    <div class="rounded-2xl border border-white/10 bg-[#1f2023] h-[180px] relative overflow-hidden">
                                                <div id="mapPreview" class="absolute inset-0"></div>
                    </div>

                                        <div class="grid grid-cols-2 gap-4">
                        <div class="rounded-2xl border border-white/10 bg-search-bar p-4">
                            <div class="text-sm text-[#9aa0a6] mb-2">날씨</div>
                            <div class="flex items-center justify-between">
                                <div class="text-center"><div class="text-xs text-[#9aa0a6]">화</div><div class="text-base">☀️ 17°</div></div>
                                <div class="text-center"><div class="text-xs text-[#9aa0a6]">수</div><div class="text-base">☀️ 19°</div></div>
                                <div class="text-center"><div class="text-xs text-[#9aa0a6]">목</div><div class="text-base">☀️ 19°</div></div>
                            </div>
                            <a class="mt-2 inline-block text-xs text-google-blue hover:underline" href="#">웨더뉴스</a>
                        </div>
                        <div class="rounded-2xl border border-white/10 bg-search-bar overflow-hidden">
                            <img
                                                                src="https://via.placeholder.com/300x180/303134/e8eaed?text=Busan+Street"
                                alt="부산광역시 전경"
                                class="w-full h-full object-cover"
                            />
                        </div>
                    </div>
                </div>
            </div>
                    </section>

        <section>
            <p class="text-sm text-[#9aa0a6] mb-3">약 6개 결과</p>
                        <ul id="resultsList" class="space-y-6"></ul>
        </section>

        <aside class="hidden lg:block lg:sticky lg:top-[76px] h-fit">
                        <div class="rounded-2xl border border-white/10 bg-search-bar overflow-hidden shadow">
                <a href="https://commons.wikimedia.org/wiki/File:Camellia_japonica_NBG.jpg" target="_blank" rel="noreferrer" class="block">
                    <img 
                        referrerPolicy="no-referrer"
                                                src="https://via.placeholder.com/360x360/303134/e8eaed?text=Knowledge+Panel+Image" 
                        alt="글로컬 크리에이터" 
                        class="w-full aspect-square object-cover" 
                    />
                </a>
                <div class="p-4">
                    <div class="text-sm text-[#9aa0a6] mb-1">이름</div>
                    <div class="text-base text-[#e8eaed] font-semibold">글로컬 크리에이터</div>
                    <a href="https://commons.wikimedia.org/wiki/File:Camellia_japonica_NBG.jpg" target="_blank" rel="noreferrer" class="mt-2 inline-block text-google-blue text-sm hover:underline">부산외국어대학교 : 박광우 교수</a>
                </div>
            </div>
        </aside>
    </main>

    <footer class="max-w-7xl mx-auto px-4 mt-10 py-6 text-xs text-[#9aa0a6] border-t border-white/10">
        <div class="flex flex-wrap items-center gap-4">
            <span>대한민국 · 부산 · 하단</span>
            <span class="text-[#5f6368]">·</span>
            <span>이 미리보기는 학습·시연용 UI 클론입니다.</span>
        </div>
    </footer>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Leaflet 아이콘 경로 명시적 설정 (404 오류 해결)
    if (window.L && L.Icon && L.Icon.Default) {
        L.Icon.Default.mergeOptions({
            iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png'
        });
    }

    const seedResults = [
        { title: "[부산한정] NFC 비누비누 베이베 키링 · GLOCAL:HD", url: "/busan-paris-festival/product-page.html", displayUrl: "glocal-hd.com/product/...r", snippet: "사하구 하단 문화의거리에서 열리는 프렌치 마르쉐 & 공연 축제입니다. 부산외국어대학교 글로컬 크리에이터 하단 팀이 함께하는 프로젝트로, 일정·프로그램·티켓·지도 정보를 한눈에 확인할 수 있습니다.", rating: 4.9, reviews: 1482 },
        { title: "하단 숙박/체험 로컬 여행 상품 리스트 · 하단.음숙.다.대.허브", url: "/busan-paris-festival/tour-list.html", displayUrl: "hadan.umsuk.daedae.heobeo", snippet: "부산 사하구 하단 문화의거리 기반의 로컬 여행 상품 추천 목록입니다. K-인싸 투어, 1일 비누 만들기, 로컬 맛집 등 다양한 테마별 액티비티와 숙박 정보를 제공합니다.", rating: 4.6, reviews: 524 },
        { title: "부산 파리 마르쉐 · 공식 안내(일정·오시는 길)", url: "/busan-paris-festival/paris-festival.html", displayUrl: "busan-parisfest.kr", snippet: "사하구 하단 문화의거리에서 열리는 프렌치 마르쉐 & 공연 축제입니다. 프랑스의 마르쉐와 카페 문화를 옮겨온 도시형 축제로, 디저트/치즈, 공연, 포토스팟을 즐길 수 있습니다. (일정: 2025. 12. 6(토) - 12. 7(일))", rating: 4.7, reviews: 861 },
        { title: "하단 재즈 나잇 · 공연 라인업 및 타임테이블", url: "https://hadanjazz.kr/lineup", displayUrl: "hadanjazz.kr", snippet: "하단역 일대에서 열리는 도심형 재즈 축제입니다. 국내외 재즈 아티스트, 게스트 세션 정보와 공연 시간표를 미리 만나보세요.", rating: 4.8, reviews: 1023 },
        { title: "다대포 선셋 포토워크 · 참가자 모집(하단 출발)", url: "https://www.dadaepo-sunset.com/walk", displayUrl: "dadaepo-sunset.com", snippet: "하단에서 출발해 다대포 해변 일몰 명소를 걷는 포토워크입니다. 촬영 포인트, 복장 가이드, 날씨 체크리스트를 참고해보세요.", rating: 4.5, reviews: 392 },
        { title: "로컬 베이커리 위크 in 하단 · 참가 매장 안내", url: "https://bakeryweek.kr/hadan", displayUrl: "bakeryweek.kr", snippet: "하단의 개성 있는 로컬 베이커리 20여 곳이 참여합니다. 시그니처 메뉴, 빵 굽는 시간, 스탬프 위치와 한정 굿즈 정보를 제공합니다.", rating: 4.6, reviews: 745 },
    ];

    function renderResults(results) {
        const list = document.getElementById('resultsList');
        if (!list) return;
        
        list.innerHTML = results.map(r => `
            <li class="group border-b border-white/10 pb-4">
                <div class="text-xs text-[#9aa0a6] mb-1">${r.displayUrl}</div>
                <a href="${r.url}" target="${r.url.startsWith('http') ? '_blank' : '_self'}" rel="noreferrer" class="block">
                    <div class="text-lg md:text-xl leading-snug text-google-blue group-hover:underline">${r.title}</div>
                </a>
                <div class="mt-1 flex items-center gap-2 text-sm text-[#e8eaed]">
                    <span class="font-semibold text-google-yellow">★ ${r.rating}</span>
                    <span class="text-[#9aa0a6]">(${r.reviews.toLocaleString()}건의 리뷰)</span>
                </div>
                <div class="mt-1 text-[#bdc1c6] leading-relaxed">${r.snippet}</div>
            </li>
        `).join('');
    }

    let mapInstance = null;
    let mapInitialized = false; // 플래그 추가

    function initializeMap() {
        const L = window.L;
        const el = document.getElementById("mapPreview");
        
        // ⭐️ Leaflet이 없거나 이미 초기화되었으면 종료
        if (!L || !el || mapInitialized) {
            return;
        }

        try {
            mapInitialized = true; // 초기화 시작 플래그 설정
            
            if (mapInstance) { mapInstance.remove(); }

            // 지도 초기화 (하단역 근처 좌표)
            mapInstance = L.map(el, { 
                zoomControl: false, 
                scrollWheelZoom: false 
            }).setView([35.104, 128.966], 14);
            
            // 표준 OpenStreetMap 타일 적용
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(mapInstance);
            
            // 마커 추가
            L.marker([35.104, 128.966]).addTo(mapInstance).bindPopup("하단역").openPopup();
            
            // ⭐️ 핵심 수정: 지도 객체가 준비된 후 크기 재계산과 리사이즈 이벤트 핸들러 추가
            mapInstance.whenReady(function() {
                // ⭐️ whenReady가 실행될 때 (지도가 로드될 때) 즉시 크기 재계산
                this.invalidateSize(); 

                // ⭐️ DOM 렌더링을 위해 약간의 시간(10ms)을 준 후 재계산 (타일 누락 방지)
                setTimeout(() => {
                    this.invalidateSize();
                }, 10);
                
                // ⭐️ resize 이벤트 핸들러를 여기에 등록하여 중복 초기화를 막습니다.
                window.addEventListener('resize', () => {
                    if (mapInstance) {
                        mapInstance.invalidateSize();
                    }
                });
            });

        } catch (err) {
            console.error("Leaflet map initialization failed:", err);
            mapInitialized = false; // 실패 시 재시도 가능하도록 플래그 해제
        }
    }

    // ⭐️ DOMContentLoaded에서 검색 결과와 지도 초기화
    document.addEventListener('DOMContentLoaded', () => {
        renderResults(seedResults);
        initializeMap();
    });
    
    // ⭐️ 안전을 위해 window load 시점에도 다시 시도 (리소스를 완전히 로드한 후)
    window.addEventListener('load', initializeMap);

    // ⭐️ 기존 window.addEventListener('resize')는 initializeMap 내부로 이동했습니다.
</script>

</body>
</html>
